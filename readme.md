# Хакатон DatsMagic

2 дневный хакатон в котором я участвовал с другом и попал в топ 15. Цель - разработка бота в физической симуляции с взаимодействием через API

![игровая карта](assets/игровая%20карта.gif)

Легенда: Научные сотрудники НИИ Чудес воплотили в реальность мечты о полётах на ковре-самолёте. И стало возможным добраться до всех сокровищ пустыни - нужно собрать как можно больше. На пути встретятся аномальные вихри, и другие искатели сокровищ с не добрыми намерениями

Игроки через API управляют 5 коврами и задают им движение по карте, собирая сокровища, уклоняясь от аномалий и сбивая вражеские корвы. Все действия на карте происходят непрерывно (десятки раз в секунду). Игроки имеют возможность 3 раза в секунду вызывать API (ограничение на токен). Действие происходит на одной карте, все игроки могут взаимодействовать между собой (атака, столкновение, кража золота из-под носа)

[API дока](https://gamethon.datsteam.dev/datsmagic/documentation/#section/Opisanie-konstant-v-API)

[Игровая статистика](https://datsteam.dev/datsmagic/magicstats)

## Стратегия

TLDR: летаем на максимальной скорости по карте и собираем все монеты по пути

Корабли при спавне выбирают рандомное направление и летят туда пока не увидят перед собой монетку. Когда увидят то _пытаются_ ее забрать. Если видят несколько то выбирают самую ценную. Их зрение - какое то количество шагов вперед и угол обзора в 120 градусов. Они летят только в одну сторону чтобы не терять скорость - ускорение за одну секунду это всего 1/10 максимальной скорости

Если долетают до конца карты то разворачиваются на 180 градусов. Если видят аномалию то разворачиваются на 120 градусов

Когда встречают противника на линии огня, то включают щит. Если у противника нет щита, то стреляют. Если противников несколько то цель выбирают по killBounty

## Успехи и проблемы

Данная стратегия работает, и по ней работают топ команды в таблице рекордов

Наша реализация стабильно собирает 2000 - 3000 очков, что удерживало нас в топ 15 в первый день, и в топ 50 в последующие

Основные проблемы:

- Плохо рассчитывается какое ускорение нужно приложить к кораблю чтобы он надежно поменял курс и оказался в желаемом месте
- Не работает спасение от вылета за пределы карты
- Обход аномалий не достаточно проработан и в 50% случаев ковер влетает прямо в эпицентр

Макубуки мы не выиграли :(

## Запуск

Для запуска игровой логики:

1. Установите зависимости: `pip install -r requirements.txt`
2. Запустите скрипт: `python main.py`

Для запуска визуализации:

1. Убедитесь что main.py запущен
2. Запустите сервер для хоста файлов директории: `python -m http.server`
3. Откройте в браузере `http://localhost:8000/index.html`
4. (опционально) получите публичную ссылку с помощью ngrok: `ngrok http 8000`

## Техническое

Стек:

- Python 3.10 для игровой логики
- Javascript с canvas для визуализации

`main.py` - основной скрипт для управление коврами

`index.html` - страница визуализации

`state.json` - ответ с сервера с обстановкой на карте, и его же читает index.html

Список терминов внутри скриптов:

`transport` - наш ковер / кораблик

`coord` - координата

`bounty` - монетка с координатой и очками

`point / points` - золото / монеты / очки / руны
